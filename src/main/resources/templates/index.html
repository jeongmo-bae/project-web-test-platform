<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Campaign Test Platform</title>
    <link rel="icon" type="image/png" href="/img/dooduge-logo.png">
    <link rel="stylesheet" href="/css/testauto.css">
</head>
<body>

<header class="app-header">
    <div class="app-header-left">
        <img src="/img/dooduge-logo.png" alt="dooduge Logo" class="app-logo">
        <!-- 이 a 태그 누르면 index로 이동 -->
        <a href="/" class="app-title">Campaign Test Platform</a>
    </div>
</header>

<div class="app-shell">
    <!-- 좌측 사이드바 -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-section-title">Test-Tree</div>
            <input id="test-search"
                   type="text"
                   placeholder="Find a test..."
                   style="width: 100%; padding: 6px 8px; font-size: 13px; margin-bottom: 10px;
              border: 1px solid var(--border-color); border-radius: 4px;">
            <div class="test-tree-container">
                <div class="tree-root-label">
                    <img src="/icons/folder-dark.svg" alt="">
                    <!-- 루트 패키지명 -->
                    <span th:text="${rootPackageName}">디폴트값임나오면안됨</span>
                </div>

                <!-- 최상위 노드들 -->
                <ul class="tree-root" id="tree-root">
                    <li th:each="node : ${testTree}">
                        <th:block th:insert="~{::treeNodeFragment(node=${node})}"></th:block>
                    </li>
                </ul>
            </div>
        </div>
    </aside>

    <!-- 사이드바 리사이저 -->
    <div class="sidebar-resizer" id="sidebar-resizer"></div>

    <!-- 우측 메인 영역 -->
    <main class="main">
        <div class="main-card">
            <div class="main-card-title">Welcome to Campaign Test Platform</div>
            <div class="main-card-subtitle">
                좌측에서 테스트 클래스를 선택한 뒤, 상단 또는 우측에 실행 버튼/필터 넣을 예정.
            </div>

            <!-- 여기부터는 실제 index 화면에 보여줄 내용 -->
            <p>이 영역에 최근 테스트 실행 결과, 실행 버튼, 필터 UI 등을 배치하면 됨.</p>
        </div>
    </main>
</div>

<!-- 트리 렌더링용 Thymeleaf fragment -->
<th:block th:fragment="treeNodeFragment (node)">
    <!-- node / children null-safe로 한 번만 계산 -->
    <th:block th:with="hasChildren=${node != null and node.children != null and !#lists.isEmpty(node.children)}">
        <div class="tree-node"
             th:classappend="${hasChildren} ? ' is-package' : ' is-leaf is-class'"
             th:attr="data-has-children=${hasChildren}">

            <!-- 접기/펼치기 화살표 -->
            <span class="tree-node-toggle"
                  th:text="${hasChildren} ? '▼' : ''">▼</span>

            <!-- 아이콘 영역 -->
            <span class="tree-node-icon">
                <img th:if="${hasChildren}" src="/icons/folder-dark.svg" alt="folder">
                <img th:if="${!hasChildren}" src="/icons/class-dark.svg" alt="class">
            </span>

            <!-- 이름 -->
            <span class="tree-node-label"
                  th:text="${node != null ? node.name : 'UNKNOWN'}">NodeName</span>
        </div>

        <ul class="tree-children"
            th:if="${hasChildren}">
            <li th:each="child : ${node.children}">
                <th:block th:insert="~{::treeNodeFragment(node=${child})}"></th:block>
            </li>
        </ul>
    </th:block>
</th:block>

<script src="/js/side-bar.js"></script>

</body>
</html>