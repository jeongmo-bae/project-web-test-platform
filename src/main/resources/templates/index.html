<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Test Platform</title>
    <link rel="icon" type="image/png" href="/img/dooduge-logo.png">
    <link rel="stylesheet" href="/css/testauto.css">
</head>
<body>

<header class="app-header">
    <div class="app-header-left">
        <img src="/img/dooduge-logo.png" alt="dooduge Logo" class="app-logo">
        <a href="/" class="app-title">Campaign Test Platform</a>
    </div>
    <nav class="app-header-nav">
        <button class="header-nav-button active" data-view="dashboard">Dashboard</button>
        <button class="header-nav-button" data-view="test-info">Test Info</button>
        <button class="header-nav-button" data-view="test-results">Results</button>
    </nav>
    <div class="app-header-right"></div>
</header>

<div class="app-shell">
    <!-- ì¢Œì¸¡ ì‚¬ì´ë“œë°” -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title-row">
                <h2>Test Explorer</h2>
                <button class="refresh-button" id="refreshButton" title="Refresh test list">â†»</button>
            </div>
            <button class="run-button" id="runButton" disabled>Run Selected Tests</button>
        </div>
        <div class="sidebar-section">
            <input id="test-search"
                   type="text"
                   placeholder="Find a test..."
                   class="search-input">
            <div class="test-tree-container">
                <div class="tree-root-label">
                    <img src="/icons/folder-dark.svg" alt="">
                    <span th:text="${rootPackageName}">testcode</span>
                </div>

                <!-- ìµœìƒìœ„ ë…¸ë“œë“¤ -->
                <ul class="tree-root" id="tree-root">
                    <li th:each="node : ${testTree}">
                        <th:block th:insert="~{::treeNodeFragment(node=${node})}"></th:block>
                    </li>
                </ul>
            </div>
        </div>
    </aside>

    <!-- ì‚¬ì´ë“œë°” ë¦¬ì‚¬ì´ì € -->
    <div class="sidebar-resizer" id="sidebar-resizer"></div>

    <!-- ìš°ì¸¡ ë©”ì¸ ì˜ì—­ -->
    <main class="main">
        <!-- Dashboard ë·° -->
        <div class="view-panel active" id="viewDashboard">
            <div class="dashboard-container" id="dashboardContent">
                <div class="dashboard-loading">
                    <div class="loading-spinner"></div>
                    <p>Loading dashboard...</p>
                </div>
            </div>
        </div>

        <!-- Test Information ë·° -->
        <div class="view-panel" id="viewTestInfo">
            <div class="content-area" id="testInfoContent">
                <div class="empty-state">
                    <div class="empty-state-icon">&#128196;</div>
                    <p>Select a test class from the left panel</p>
                </div>
            </div>
        </div>

        <!-- Test Results ë·° -->
        <div class="view-panel" id="viewTestResults">
            <div class="content-area" id="testResultsContent">
                <div class="empty-state">
                    <div class="empty-state-icon">&#128202;</div>
                    <p>No test results available</p>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- íŠ¸ë¦¬ ë Œë”ë§ìš© Thymeleaf fragment -->
<th:block th:fragment="treeNodeFragment (node)">
    <th:block th:with="hasChildren=${node != null and node.children != null and !#lists.isEmpty(node.children)},
                       hasClassName=${node != null and node.className != null and node.className != ''},
                       isClass=${node != null and node.type != null and 'CLASS'.equals(node.type)}">
        <div class="tree-node"
             th:classappend="${isClass} ? ' is-class class-node' : (${hasChildren} ? ' is-package' : ' is-leaf')"
             th:attr="data-has-children=${hasChildren},
                      data-class=${hasClassName ? node.className : null}">

            <!-- ì²´í¬ë°•ìŠ¤ (í´ëž˜ìŠ¤ì¸ ê²½ìš°ë§Œ) -->
            <input th:if="${isClass}"
                   type="checkbox"
                   class="class-checkbox"
                   th:attr="data-class=${node.className}"
                   onclick="event.stopPropagation();">

            <!-- ì ‘ê¸°/íŽ¼ì¹˜ê¸° í™”ì‚´í‘œ -->
            <span class="tree-node-toggle"
                  th:text="${hasChildren} ? 'â–¼' : ''"></span>

            <!-- ì•„ì´ì½˜ ì˜ì—­ -->
            <span class="tree-node-icon">
                <img th:if="${isClass}" src="/icons/class-dark.svg" alt="C" title="Test Class">
                <img th:if="${hasChildren and !isClass}" src="/icons/folder-dark.svg" alt="ðŸ“" title="Package">
            </span>

            <!-- ì´ë¦„ -->
            <span class="tree-node-label"
                  th:text="${node != null ? node.name : 'UNKNOWN'}">NodeName</span>
        </div>

        <ul class="tree-children"
            th:if="${hasChildren}">
            <li th:each="child : ${node.children}">
                <th:block th:insert="~{::treeNodeFragment(node=${child})}"></th:block>
            </li>
        </ul>
    </th:block>
</th:block>

<script src="/js/side-bar.js"></script>

</body>
</html>